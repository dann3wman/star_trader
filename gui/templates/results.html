<!doctype html>
<html>
  <head>
    <title>Results</title>
    <!-- Include the Foundation CSS framework -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/foundation-sites/dist/css/foundation.min.css">
    <!-- Chart.js for interactive charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body class="grid-container">
    <h1>Results for {{ days }} day(s)</h1>
    <table class="hover">
      <tr>
        <th>Good</th>
        <th>Low</th>
        <th>High</th>
        <th>Current</th>
      </tr>
      {% for good, data in results.items() %}
      <tr>
        <td>{{ good }}</td>
        <td>{{ data.low }}</td>
        <td>{{ data.high }}</td>
        <td>{{ data.current }}</td>
      </tr>
      {% endfor %}
    </table>

    <h2>Price and Volume Charts</h2>
    {% set idx = 1 %}
    {% for good, data in results.items() %}
    <h3>{{ good }}</h3>
    <canvas id="priceChart-{{ idx }}" width="400" height="200"></canvas>
    <canvas id="volumeChart-{{ idx }}" width="400" height="200"></canvas>
    {% set idx = idx + 1 %}
    {% endfor %}

    <h2>Daily Prices</h2>
    <table class="hover">
      <tr>
        <th>Good</th>
        {% for day in range(1, days + 1) %}
        <th>Day {{ day }}</th>
        {% endfor %}
      </tr>
      {% for good, data in results.items() %}
      <tr>
        <td>{{ good }}</td>
        {% for price in data.prices %}
        <td>{% if price is none %}N/A{% else %}{{ price }}{% endif %}</td>
        {% endfor %}
      </tr>
      {% endfor %}
    </table>

    <h2>Agent Stats</h2>
    <table class="hover">
      <tr>
        <th>Name</th>
        <th>Job</th>
        <th>Money</th>
        <th>Total Profit</th>
      </tr>
      {% for agent in agents %}
      <tr>
        <td>{{ agent.name }}</td>
        <td>{{ agent.job }}</td>
        <td>{{ agent.money }}</td>
        <td>{{ agent.profit }}</td>
      </tr>
      {% endfor %}
    </table>
    <p><a href="/">Run another simulation</a></p>
    <script>
      const results = {{ results|tojson }};
      const days = {{ days }};
      const labels = Array.from({length: days}, (_, i) => `Day ${i+1}`);
      let idx = 1;
      for (const [good, data] of Object.entries(results)) {
        const priceCtx = document.getElementById(`priceChart-${idx}`).getContext('2d');
        new Chart(priceCtx, {
          type: 'line',
          data: {
            labels: labels,
            datasets: [{
              label: `${good} Price`,
              data: data.prices,
              fill: false,
              borderColor: 'blue'
            }]
          },
          options: {responsive: false}
        });
        const volCtx = document.getElementById(`volumeChart-${idx}`).getContext('2d');
        new Chart(volCtx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: `${good} Volume`,
              data: data.volumes,
              backgroundColor: 'orange'
            }]
          },
          options: {responsive: false}
        });
        idx++;
      }
    </script>
  </body>
</html>
